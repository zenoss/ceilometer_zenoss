---
# Nova Instance Events
- event_type: compute.instance.*
  traits: &instance_traits
    priority:
      fields: priority
    display_name:
      fields: payload.display_name
    instance_id:
      fields: payload.instance_id
    state:
      fields: payload.state
    old_state:
      fields: payload.old_state
    state_description:
      fields: payload.state_description
    fixed_ips:
      fields: payload.fixed_ips
    flavor_name:
      fields: payload.instance_type
    image_name:
      fields: payload.image_name
    tenant_id:
      fields: payload.tenant_id
    user_id:
      fields: payload.user_id
    host_name:
      fields: publisher_id
      plugin:
        name: split
        parameters:
          segment: 1
          max_split: 1
    service:
      fields: publisher_id
      plugin: split
    memory_mb:
      type: int
      fields: payload.memory_mb
    disk_gb:
      type: int
      fields: payload.disk_gb
    root_gb:
      type: int
      fields: payload.root_gb
    ephemeral_gb:
      type: int
      fields: payload.ephemeral_gb
    vcpus:
      type: int
      fields: payload.vcpus
    os_architecture:
      fields: payload.image_meta.'org.openstack__1__architecture'
    os_version:
      fields: payload.image_meta.'org.openstack__1__os_version'
    os_distro:
      fields: payload.image_meta.'org.openstack__1__os_distro'
    launched_at:
      type: datetime
      fields: payload.launched_at
    deleted_at:
      type: datetime
      fields: payload.deleted_at
- event_type: compute.instance.exists
  traits:
    <<: *instance_traits
    audit_period_beginning:
      type: datetime
      fields: payload.audit_period_beginning
    audit_period_ending:
      type: datetime
      fields: payload.audit_period_ending

# ------------------------------------------------------------------------------
# Neutron Events (Base for Inheritance)
# ------------------------------------------------------------------------------
- event_type: neutron.*
  traits: &neutron_traits
    priority:
      fields: priority
    event_type:
      fields: event_type

# ------------------------------------------------------------------------------
# dhcp Events
# ------------------------------------------------------------------------------
- event_type: dhcp_agent.*
  traits:
    <<: *neutron_traits
    id:
      fields: payload.agent.id
    network_id:
      fields: payload.agent.network_id

# ------------------------------------------------------------------------------
# FloatingIP
# ------------------------------------------------------------------------------
- event_type: floatingip.*
  traits:
    <<: *neutron_traits
    fixed_ip_address:
      fields: payload.floatingip.fixed_ip_address
    floating_ip_address:
      fields: payload.floatingip.floating_ip_address
    floating_network_id:
      fields: payload.floatingip.floating_network_id
    id:
      fields: payload.floatingip.id
    port_id:
      fields: payload.floatingip.port_id
    router_id:
      fields: payload.floatingip.router_id
    status:
      fields: payload.floatingip.status
    tenant_id:
      fields: payload.floatingip.tenant_id

# ------------------------------------------------------------------------------
# network Events
# ------------------------------------------------------------------------------
- event_type: network.*
  traits:
    <<: *neutron_traits
    admin_state_up:
      fields: payload.network.admin_state_up
    id:
      fields: payload.network.id
    name:
      fields: payload.network.name
    provider_network_type:
      fields: payload.network.'provider:network_type'
    provider_physical_network:
      fields: payload.network.'provider:physical_network'
    provider_segmentation_id:
      fields: payload.network.'provider:segmentation_id'
    router_external:
      fields: payload.network.router:external
    shared:
      fields: payload.network.shared
    status:
      fields: payload.network.status
    subnets:
      fields: payload.network.subnets
    tenant_id:
      fields: payload.network.tenant_id


# ------------------------------------------------------------------------------
# port Events
# ------------------------------------------------------------------------------
- event_type: port.*
  traits:
    <<: *neutron_traits
    id:                     
      fields: payload.port.id
    name:                   
      fields: payload.port.name
    admin_state_up:         
      fields: payload.port.admin_state_up
    allowed_address_pairs:  
      fields: payload.port.allowed_address_pairs
    binding_host_id:        
      fields: payload.port.'binding:host_id'
    binding_profile:
      fields: payload.port.'binding:profile'
    binding_vif_details:
      fields: payload.port.'binding:vif_details'
    binding_vif_type:
      fields: payload.port.'binding:vif_type'
    binding_vnic_type:
      fields: payload.port.'binding:vnic_type'
    device_id:              
      fields: payload.port.device_id
    device_owner:           
      fields: payload.port.device_owner
    extra_dhcp_opts:        
      fields: payload.port.extra_dhcp_opts
    fixed_ips:              
      fields: payload.port.fixed_ips
    mac_address:            
      fields: payload.port.mac_address
    network_id:             
      fields: payload.port.network_id
    security_groups:        
      fields: payload.port.security_groups
    status:                 
      fields: payload.port.status
    tenant_id:              
      fields: payload.port.tenant_id


# ------------------------------------------------------------------------------
# router Events
# ------------------------------------------------------------------------------
- event_type: router.*
  traits:
    <<: *neutron_traits

# ------------------------------------------------------------------------------
# security_group Events
# ------------------------------------------------------------------------------
- event_type: security_group.*
  traits:
    <<: *neutron_traits

# ------------------------------------------------------------------------------
# security_group_rule Events
# ------------------------------------------------------------------------------
- event_type: security_group_rule.*
  traits:
    <<: *neutron_traits

# ------------------------------------------------------------------------------
# subnet Events
# ------------------------------------------------------------------------------
- event_type: subnet.*
  traits:
    <<: *neutron_traits

